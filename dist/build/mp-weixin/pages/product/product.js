(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"0db7":function(t,e,n){},2718:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("a34a")),r=n("c4c8"),i=n("2b74"),c=o(n("8f09")),s=n("802d");function o(t){return t&&t.__esModule?t:{default:t}}function u(t){return d(t)||p(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function d(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function h(t,e,n,a,r,i,c){try{var s=t[i](c),o=s.value}catch(u){return void n(u)}s.done?e(o):Promise.resolve(o).then(a,r)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var i=t.apply(e,n);function c(t){h(i,a,r,c,s,"next",t)}function s(t){h(i,a,r,c,s,"throw",t)}c(void 0)}))}}var _=function(){return n.e("components/rf-number-box/index").then(n.bind(null,"b279"))},g=function(){return n.e("components/rf-rate/rf-rate").then(n.bind(null,"6c8d"))},m=function(){return n.e("components/rf-badge/rf-badge").then(n.bind(null,"bf8c"))},v={components:{rfBadge:m,rfRate:g,rfNumberBox:_},filters:{formatRichText:function(t){if(t){var e=t.replace(/<img[^>]*>/gi,(function(t,e){return t=t.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),t=t.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),t=t.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),t}));return e=e.replace(/style="[^"]+"/gi,(function(t,e){return t=t.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),t})),e=e.replace(/<br[^>]*\/>/gi,""),e=e.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),e}return"暂无商品详情"},time:function(t){return(0,c.default)(1e3*t).format("YYYY-MM-DD HH:mm")},discountFilter:function(t){return 10*t.toFixed(2)},maxBuyFilter:function(t){return 0===parseInt(t,10)?"不限购":"限购：".concat(t)},pointExchangeTypeFilter:function(t){var e=["","非积分兑换","积分加现金","积分兑换或直接购买","只支持积分兑换"];return e[parseInt(t,10)]},integralGiveTypeFilter:function(t){var e=["固定积分","百分比"];return e[parseInt(t,10)]},givePointFilter:function(t){return 1===parseInt(t.integral_give_type,10)?"".concat(Math.round(parseInt(t.give_point,10)/100*parseInt(t.minSkuPrice,10))," 积分"):parseInt(t.integral_give_type,10)}},data:function(){return{serviceClass:"none",ladderPreferentialClass:"none",attributeValueClass:"none",cartType:null,maskState:0,couponList:[],productDetail:{},styleObject:{},showTypeImage:null,specClass:"none",specSelected:[],favorite:!1,shareList:[],currentStock:null,currentSkuPrice:null,specList:[],specChildList:[],cartCount:1,product_id:null,evaluateList:[],token:null,cartNum:null,loading:!0,errorInfo:""}},computed:{buyBtnDisabled:function(){return 0==(this.currentStock||this.productDetail.stock)},addCartBtnDisabled:function(){return 2==this.productDetail.point_exchange_type||4==this.productDetail.point_exchange_type||0==(this.currentStock||this.productDetail.stock)||1==this.productDetail.is_virtual}},onLoad:function(){var t=f(a.default.mark((function t(e){var n=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.initData(e.id),this.specList.forEach((function(t){var e=!0,a=!1,r=void 0;try{for(var i,c=n.specChildList[Symbol.iterator]();!(e=(i=c.next()).done);e=!0){var s=i.value;if(s.pid===t.id){n.$set(s,"selected",!0),n.specSelected.push(s);break}}}catch(o){a=!0,r=o}finally{try{e||null==c.return||c.return()}finally{if(a)throw r}}})),this.product_id=e.id;case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onShareAppMessage:function(t){var e=this;this.$post("".concat(i.transmitCreate),{topic_type:"product",topic_id:this.product_id}).then((function(){return{title:e.productDetail.name,path:"/pages/product/product?id="+e.product_id}}))},methods:{navTo:function(e){this.token?t.navigateTo({url:e}):t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&t.reLaunch({url:"/pages/public/logintype"})}})},showService:function(){this.productDetail.tags&&0===this.productDetail.tags.length||(this.serviceClass="show")},showLadderPreferential:function(){0!==this.productDetail.ladderPreferential.length&&(this.ladderPreferentialClass="show")},showAttributeValue:function(){0!==this.productDetail.attributeValue.length&&(this.attributeValueClass="show")},shareToH5:function(){this.$api.msg("请复制连接进行分享")},hideService:function(){var t=this;this.serviceClass="hide",this.ladderPreferentialClass="hide",this.attributeValueClass="hide",setTimeout((function(){t.serviceClass="none",t.ladderPreferentialClass="none",t.attributeValueClass="none"}),200)},getCoupon:function(){var e=f(a.default.mark((function e(n){var r=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.token){e.next=4;break}return this.maskState=0,t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}}),e.abrupt("return");case 4:return e.next=6,this.$post("".concat(s.couponReceive),{id:n.id}).then((function(){r.$api.msg("领取成功"),r.maskState=0})).catch((function(t){r.maskState=0,console.log(t)}));case 6:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}(),toEvaluateList:function(){t.navigateTo({url:"/pages/order/evaluation/list?comment_num=".concat(this.productDetail.comment_num,"&evaluateStat=").concat(JSON.stringify(this.productDetail.evaluateStat))})},numberChange:function(t){this.cartCount=t.number},toggleMask:function(t){var e=this;if(this.productDetail.id){var n="show"===t?10:300,a="show"===t?1:0;this.maskState=2,setTimeout((function(){e.maskState=a}),n)}},initData:function(){var e=f(a.default.mark((function e(n){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.token=t.getStorageSync("accessToken"),this.cartNum=t.getStorageSync("cartNum"),e.next=4,this.getProductDetail(n);case 4:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}(),getProductDetail:function(){var t=f(a.default.mark((function t(e){var n=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$get("".concat(r.productDetail),{id:e}).then(function(){var t=f(a.default.mark((function t(e){var r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.loading=!1,n.productDetail=e.data,t.next=4,e.data.evaluate;case 4:n.evaluateList=t.sent,n.favorite=!!n.productDetail.myCollect,n.specList=n.productDetail.base_attribute_format,n.specList.forEach((function(t){n.specChildList=[].concat(u(n.specChildList),u(t.value))})),n.specSelected=[],e.data.base_attribute_format.forEach((function(t){t.value[0].selected=!0,n.specSelected.push(t.value[0])})),r=[],n.specSelected.forEach((function(t){r.push(t.base_spec_value_id)})),n.productDetail.sku.forEach((function(t){if(t.data===r.join("-"))return n.currentStock=t.stock,void(n.currentSkuPrice=t.price)}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){n.loading=!1,n.errorInfo=t}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),toggleSpec:function(){var e=this;if(this.productDetail.id)if("show"===this.specClass){if(!this.token)return this.specClass="none",void t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}});if(this.specSelected.length<this.productDetail.base_attribute_format.length)return void this.$api.msg("请先选择规格");if("cart"===this.cartType){if(this.cartType=null,0==this.currentStock)return void this.$api.msg("库存不足");this.handleCartItemCreate()}else if("buy"===this.cartType){if(this.cartType=null,0==this.currentStock)return void this.$api.msg("库存不足");this.buy()}this.specClass="hide",setTimeout((function(){e.specClass="none"}),250)}else"none"===this.specClass&&(this.specClass="show")},hideSpec:function(){var t=this;this.specClass="hide",setTimeout((function(){t.specClass="none"}),250)},handleCartItemCreate:function(){var e=f(a.default.mark((function e(){var n,i,c=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=null,1!==this.productDetail.sku.length){e.next=5;break}n=this.productDetail.sku[0].id,e.next=31;break;case 5:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=11;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 11:i="".concat(this.specSelected[0].base_spec_value_id);case 12:e.next=30;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=23;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:i="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id);case 21:e.next=30;break;case 23:if(3!==this.productDetail.base_attribute_format.length){e.next=30;break}if(!(this.specSelected.length<3)){e.next=29;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 29:i="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id);case 30:this.productDetail&&this.productDetail.sku.forEach((function(t){t.data!==i||(n=t.id)}));case 31:return e.next=33,this.$post("".concat(r.cartItemCreate),{sku_id:n,num:this.cartCount}).then(function(){var e=f(a.default.mark((function e(n){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.$get("".concat(r.cartItemCount)).then((function(e){t.setStorageSync("cartNum",e.data),c.cartNum=e.data}));case 2:c.$api.msg("添加成功，在购物车等");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.log(t)}));case 33:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),selectSpec:function(t,e,n){var a=this,r=this.specChildList;r.forEach((function(t){t.base_spec_id===e&&a.$set(t,"selected",!1)})),3===parseInt(n,10)&&(this.showTypeImage=r[t].data),2===parseInt(n,10)&&(this.styleObject={color:r[t].data}),this.$set(r[t],"selected",!0),this.specSelected=[],r.forEach((function(t){!0===t.selected&&a.specSelected.push(t)}));var i=[];this.specSelected.forEach((function(t){i.push(t.base_spec_value_id)})),this.productDetail.sku.forEach((function(t){if(t.data===i.join("-"))return a.currentStock=t.stock,void(a.currentSkuPrice=t.price)}))},share:function(t){return"button"===t.from&&console.log(t.target),{title:"自定义分享标题",path:"/pages/test/test?id=123"}},toFavorite:function(){var e=f(a.default.mark((function e(){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.productDetail.id){e.next=2;break}return e.abrupt("return");case 2:this.token?this.favorite?this.handleCollectDel():this.handleCollectCreate():(this.specClass="none",t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/logintype"}))}}));case 3:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),handleCollectCreate:function(){var t=f(a.default.mark((function t(){var e=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$post("".concat(i.collectCreate),{topic_id:this.product_id,topic_type:"product"}).then((function(t){e.favorite=!e.favorite,e.$api.msg("收藏成功")})).catch((function(t){console.log(t)}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleCollectDel:function(){var t=f(a.default.mark((function t(){var e=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$del("".concat(i.collectDel,"?id=").concat(this.productDetail.myCollect.id)).then((function(t){e.favorite=!e.favorite,e.$api.msg("取消收藏成功")})).catch((function(t){console.log(t)}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),buy:function(){var e=f(a.default.mark((function e(){var n,r,i,c;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(1!==this.productDetail.sku.length){e.next=4;break}n=this.productDetail.sku[0].id,e.next=33;break;case 4:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=10;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 10:r="".concat(this.specSelected[0].base_spec_value_id),"".concat(this.specSelected[0].title);case 12:e.next=32;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=24;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title);case 22:e.next=32;break;case 24:if(3!==this.productDetail.base_attribute_format.length){e.next=32;break}if(!(this.specSelected.length<3)){e.next=30;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 30:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title," ").concat(this.specSelected[2].title);case 32:this.productDetail&&this.productDetail.sku.forEach((function(t){t.data!==r||(n=t.id)}));case 33:i={},c={},c.sku_id=n,c.num=this.cartCount,2==this.productDetail.point_exchange_type||4==this.productDetail.point_exchange_type?i.type="point_exchange":i.type="buy_now",i.data=JSON.stringify(c),t.navigateTo({url:"/pages/order/create/order?data=".concat(JSON.stringify(i))});case 40:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),addCart:function(t){this.productDetail.id&&(this.specClass="show",this.cartType=t)},stopPrevent:function(){}}};e.default=v}).call(this,n("543d")["default"])},abde:function(t,e,n){"use strict";var a=n("0db7"),r=n.n(a);r.a},b675:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=(t._self._c,parseFloat(t.productDetail.market_price)),a=parseFloat(t.productDetail.price),r=parseFloat(t.productDetail.market_price),i=parseFloat(t.productDetail.price),c=t._f("discountFilter")((t.currentSkuPrice||t.productDetail.price)/t.productDetail.market_price),s=t._f("maxBuyFilter")(t.productDetail.max_buy),o=t._f("pointExchangeTypeFilter")(t.productDetail.point_exchange_type),u=t._f("integralGiveTypeFilter")(t.productDetail.integral_give_type),l=t._f("givePointFilter")(t.productDetail),p=t.__map(t.productDetail.ladderPreferential,(function(e,n){var a=parseInt(e.type,10),r=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m4:a,m5:r,m6:i}})),d=t._f("time")(t.productDetail.evaluate&&t.productDetail.evaluate[0]&&t.productDetail.evaluate[0].created_at),h=t._f("formatRichText")(t.productDetail.intro),f=t.__map(t.productDetail.ladderPreferential,(function(e,n){var a=parseInt(e.type,10),r=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m7:a,m8:r,m9:i}})),_=t.__map(t.specList,(function(e,n){var a=parseInt(e.show_type),r=parseInt(e.show_type),i=parseInt(e.show_type),c=parseInt(e.show_type);return{$orig:t.__get_orig(e),m10:a,m11:r,m12:i,m13:c}})),g=parseInt(t.currentStock||t.productDetail.stock,10),m=t.__map(t.productDetail.canReceiveCoupon,(function(e,n){var a=parseInt(e.term_of_validity_type,10),r=t._f("time")(e.start_time),i=t._f("time")(e.end_time),c=parseInt(e.range_type,10);return{$orig:t.__get_orig(e),m15:a,f7:r,f8:i,m16:c}}));t.$mp.data=Object.assign({},{$root:{m0:n,m1:a,m2:r,m3:i,f0:c,f1:s,f2:o,f3:u,f4:l,l0:p,f5:d,f6:h,l1:f,l2:_,m14:g,l3:m}})},r=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}))},c2aa:function(t,e,n){"use strict";(function(t){n("6cdc"),n("921b");a(n("66fd"));var e=a(n("ee53"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},dfd6:function(t,e,n){"use strict";n.r(e);var a=n("2718"),r=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=r.a},ee53:function(t,e,n){"use strict";n.r(e);var a=n("b675"),r=n("dfd6");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("abde");var c=n("2877"),s=Object(c["a"])(r["default"],a["a"],a["b"],!1,null,"064c427e",null);e["default"]=s.exports}},[["c2aa","common/runtime","common/vendor"]]]);